import{d as _e,a as L,t as M}from"./B9q02PmC.js";import"./CEYA472p.js";import{a1 as he,a3 as d,a4 as c,a5 as F,X as se,a2 as u,$ as oe,Z as C,_ as ye,Y as z,q as E,d as l,e as ae}from"./CkTvmw98.js";import{s as O,e as ne}from"./l61C7KQG.js";import{i as I}from"./lPEFebrr.js";import{s as q}from"./qIPODsQC.js";import{s as le,b as Ie,f as Le}from"./B1tgAyqo.js";import{b as we}from"./DBx-IR2N.js";import{i as ge}from"./DNmyc9OO.js";import{p as y,s as De,a as Se}from"./BoBM9_cA.js";import{w as Me,g as K}from"./B2bvum43.js";import{g as xe,d as Ae,u as ze,r as Ee}from"./D2J15UbQ.js";import{c as Fe}from"./DnHmEvXm.js";const ie={imageFile:null,originalFilename:"",imageUUID:null,imageUrl:"",currentBlobUrl:null,imageInfo:null,originalDimensions:null,isLoading:!1,isApplying:!1,loadingStep:"",errorMessage:""};function Be(){const{subscribe:p,set:s,update:r}=Me({...ie});function _(e,a=""){r(i=>({...i,isLoading:e,isApplying:i.isApplying,loadingStep:a,errorMessage:""}))}function t(e,a="Applying changes..."){r(i=>({...i,isApplying:e,isLoading:e,loadingStep:e?a:i.loadingStep,errorMessage:e?"":i.errorMessage}))}function g(e){r(a=>({...a,errorMessage:e,isLoading:!1,isApplying:!1,loadingStep:""}))}function f(){r(e=>{if(e.currentBlobUrl&&e.currentBlobUrl.startsWith("blob:")){try{URL.revokeObjectURL(e.currentBlobUrl)}catch{}return{...e,currentBlobUrl:null}}return e})}function o(e=!1){const a=K({subscribe:p}).errorMessage;f(),s({...ie,errorMessage:e?a:""})}async function n(e){if(!e)return;o(),_(!0,"Uploading image...");const a=URL.createObjectURL(e);r(i=>({...i,imageFile:e,originalFilename:e.name,imageUrl:a,currentBlobUrl:a,originalDimensions:null}));try{const i=await Ae(e);r(b=>({...b,imageUUID:i.UUID,imageInfo:i,imageFile:null,isLoading:!0,loadingStep:"Loading image data..."})),await v(!1)}catch(i){g(`Error uploading ${e.name}: ${i.message}`),o(!0)}}async function v(e=!0){const a=K({subscribe:p}).imageUUID;if(!a){o();return}_(!0,"Loading image preview..."),e&&t(!1),f(),await new Promise(b=>setTimeout(b,0));const i=xe(a)+"?t="+Date.now();r(b=>({...b,imageUrl:i,originalDimensions:null}))}function w(e){r(a=>({...a,isLoading:!1,isApplying:!1,loadingStep:"",originalDimensions:e}))}function B(e="Failed to load image preview."){g(e),r(a=>({...a,imageUrl:"",originalDimensions:null}))}async function U(e,a="filter"){const i=K({subscribe:p});if(!(!i.imageUUID||i.isApplying||i.isLoading)){t(!0,`Applying ${a}...`);try{const b=await e(i.imageUUID);r(R=>({...R,imageUUID:b.UUID,imageInfo:b})),await v(!1)}catch{r(R=>({...R,isLoading:!1,isApplying:!1,loadingStep:""}))}}}async function x(){await U(ze,"Undo")}async function k(){await U(Ee,"Redo")}function D(){o()}return{subscribe:p,selectAndUpload:n,refreshImage:v,applyFilter:U,undo:x,redo:k,changeImage:D,resetState:o,cleanupBlobUrl:f,imageLoadComplete:w,imageLoadError:B}}const re=Be();var ke=M("<p> </p>");function N(p,s){let r=y(s,"message",8),_=y(s,"context",8,"general");var t=_e(),g=he(t);{var f=o=>{var n=ke(),v=d(n,!0);c(n),F(()=>{le(n,1,`error-message ${_()??""}`,"svelte-1iv3s0i"),O(v,r())}),L(o,n)};I(g,o=>{r()&&o(f)})}L(p,t)}var Re=M('<div class="initial-upload-state svelte-bd2ovr"><h1 class="svelte-bd2ovr"> </h1> <p class="tool-description svelte-bd2ovr"> </p> <div class="input-area file-input-section svelte-bd2ovr"><button class="file-label button-like svelte-bd2ovr"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor" style="margin-bottom: 0.5rem;" class="svelte-bd2ovr"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path></svg> Open Image</button></div> <!></div>');function Ce(p,s){se(s,!1);let r=y(s,"title",8,"Image Tool"),_=y(s,"description",8,"Select an image to begin."),t=y(s,"errorMessage",8,"");const g=Fe();function f(){g("open")}ge();var o=Re(),n=d(o),v=d(n,!0);c(n);var w=u(n,2),B=d(w,!0);c(w);var U=u(w,2),x=d(U);c(U);var k=u(U,2);{var D=e=>{N(e,{message,context:"initial"})};I(k,e=>{t()&&e(D)})}c(o),F(()=>{O(v,r()),O(B,_())}),ne("click",x,f),L(p,o),oe()}var Oe=M('<div class="loading-state svelte-1fo0o4y"><div class="spinner svelte-1fo0o4y"></div> <p class="svelte-1fo0o4y"> </p> <!></div>');function Te(p,s){let r=y(s,"message",8,"Loading..."),_=y(s,"errorMessage",8,"");var t=Oe(),g=u(d(t),2),f=d(g,!0);c(g);var o=u(g,2);{var n=v=>{N(v,{get message(){return r()},context:"loading"})};I(o,v=>{_()&&v(n)})}c(t),F(()=>O(f,r())),L(p,t)}var je=M('<p class="svelte-d9t0zt"> </p>'),Pe=M('<div class="main-area-overlay svelte-d9t0zt"><div class="spinner svelte-d9t0zt"></div> <!></div>'),qe=M('<div><div class="top-toolbar svelte-d9t0zt"><div class="toolbar-left svelte-d9t0zt"><!></div> <div class="toolbar-right svelte-d9t0zt"><!></div></div> <div class="main-area svelte-d9t0zt"><!> <!></div> <div class="right-sidebar svelte-d9t0zt"><!> <!></div></div>'),He=M('<div class="editor-layout-wrapper svelte-d9t0zt"><div class="page-container svelte-d9t0zt"><!> <input type="file" accept="image/png, image/jpeg, image/webp, image/gif" style="display: none;" class="svelte-d9t0zt"></div></div>');function at(p,s){se(s,!1);const[r,_]=De(),t=()=>Se(re,"$imageEditorStore",r),g=E(),f=E(),o=E(),n=E(),v=E();let w=y(s,"toolTitle",8,"Image Editor"),B=y(s,"toolDescription",8,"Select an image to start editing."),U=E();function x(){var m;(m=l(U))==null||m.click()}function k(m){var j,P;const T=(P=(j=m.target)==null?void 0:j.files)==null?void 0:P[0];T&&re.selectAndUpload(T),m.target&&(m.target.value=null)}function D(){x()}C(()=>t(),()=>{z(g,t().isLoading)}),C(()=>t(),()=>{z(f,t().isApplying)}),C(()=>t(),()=>{z(o,t().loadingStep)}),C(()=>t(),()=>{z(n,t().errorMessage)}),C(()=>t(),()=>{z(v,!!t().imageUUID||!!t().imageUrl)}),ye(),ge();var e=He(),a=d(e),i=d(a);{var b=m=>{Ce(m,{get title(){return w()},get description(){return B()},get errorMessage(){return l(n)},$$events:{open:x}})},R=(m,T)=>{{var j=A=>{const S=ae(()=>l(o)||"Loading...");Te(A,{get message(){return l(S)},get errorMessage(){return l(n)}})},P=A=>{var S=qe();let Q;var W=d(S),X=d(W),de=d(X);q(de,s,"toolbar-left",{openFilePicker:D}),c(X);var V=u(X,2),ce=d(V);q(ce,s,"toolbar-right",{openFilePicker:D}),c(V),c(W);var Y=u(W,2),$=d(Y);q($,s,"main-content",{});var ve=u($,2);{var me=h=>{var Z=Pe(),fe=u(d(Z),2);{var Ue=G=>{var J=je(),be=d(J,!0);c(J),F(()=>O(be,l(o))),L(G,J)};I(fe,G=>{l(o)&&G(Ue)})}c(Z),L(h,Z)};I(ve,h=>{l(g)&&l(v)&&t().imageUrl&&h(me)})}c(Y);var ee=u(Y,2),te=d(ee);q(te,s,"sidebar-content",{openFilePicker:D});var pe=u(te,2);{var ue=h=>{N(h,{get message(){return l(n)},context:"sidebar"})};I(pe,h=>{l(n)&&h(ue)})}c(ee),c(S),F(h=>Q=le(S,1,"editor-interface svelte-d9t0zt",null,Q,h),[()=>({loading:l(g)})],ae),Ie(3,S,()=>Le,()=>({duration:300})),L(A,S)};I(m,A=>{l(g)&&(!l(v)||!t().imageUrl)?A(j):A(P,!1)},T)}};I(i,m=>{!l(v)&&!l(g)?m(b):m(R,!1)})}var H=u(i,2);we(H,m=>z(U,m),()=>l(U)),c(a),c(e),F(()=>H.disabled=l(g)),ne("change",H,k),L(p,e),oe(),_()}export{N as E,at as I,re as i};
