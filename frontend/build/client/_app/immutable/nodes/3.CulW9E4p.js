import{t as j,a as h,b as Ce}from"../chunks/B9q02PmC.js";import"../chunks/CEYA472p.js";import{X as De,d as e,Y as o,Z as re,_ as we,$ as Fe,q as y,a0 as $e,a1 as Ie,e as ie,a2 as c,a3 as d,a4 as m,a5 as T,a6 as Ae,a7 as le}from"../chunks/CkTvmw98.js";import{h as ke,s as q,e as A}from"../chunks/l61C7KQG.js";import{i as z}from"../chunks/lPEFebrr.js";import{r as Me,s as G,a as ae}from"../chunks/B1tgAyqo.js";import{s as Se}from"../chunks/D0lxRREg.js";import{F as ze,H as Ue,D as Ee,b as Le}from"../chunks/Dfkrt3rs.js";import{b as Re}from"../chunks/DBx-IR2N.js";import{i as Ze}from"../chunks/DNmyc9OO.js";import{s as Ne,a as Pe}from"../chunks/BoBM9_cA.js";import{o as We,a as He}from"../chunks/DnHmEvXm.js";import{i as k,I as Be}from"../chunks/D7iErLRr.js";import{d as U,l as ne}from"../chunks/ier4OYVO.js";import{a as Te}from"../chunks/D2J15UbQ.js";var qe=j('<div slot="toolbar-left" class="svelte-n07j1b"><span class="toolbar-label svelte-n07j1b">Aspect Ratio:</span> <div class="aspect-ratio-controls svelte-n07j1b"><button>Free</button> <button>1:1</button> <button>4:3</button> <button>16:9</button></div></div>'),Oe=j('<span class="button-spinner svelte-n07j1b"></span> Applying...',1),Ve=j('<div slot="toolbar-right" class="svelte-n07j1b"><button class="apply-button button-like toolbar-button svelte-n07j1b"><!></button></div>'),Xe=j('<div class="cropper-container svelte-n07j1b"><img class="crop-image svelte-n07j1b" crossorigin="anonymous"></div>'),Ye=j('<p class="placeholder-text svelte-n07j1b">Select an image to start.</p>'),Ge=j('<div slot="main-content" class="cropper-main-content svelte-n07j1b"><!></div>'),Je=j('<div class="details-grid svelte-n07j1b"><span class="svelte-n07j1b">W:</span> <span class="svelte-n07j1b"> </span> <span class="svelte-n07j1b">H:</span> <span class="svelte-n07j1b"> </span> <span class="svelte-n07j1b">X:</span> <span class="svelte-n07j1b"> </span> <span class="svelte-n07j1b">Y:</span> <span class="svelte-n07j1b"> </span></div>'),Ke=j('<p class="placeholder-text-small svelte-n07j1b">Initializing crop area...</p>'),Qe=j('<p class="placeholder-text-small svelte-n07j1b">Loading...</p>'),ea=j('<p class="placeholder-text-small svelte-n07j1b">No selection.</p>'),aa=j('<!> <div class="sidebar-section section-details svelte-n07j1b"><h4 class="h4-pink svelte-n07j1b">Current Selection</h4> <!></div> <div class="sidebar-section section-controls svelte-n07j1b"><h4 class="h4-teal svelte-n07j1b">Controls</h4> <div class="control-item zoom-controls svelte-n07j1b"><label for="zoom-slider" class="svelte-n07j1b">Zoom</label> <input id="zoom-slider" type="range" min="1" max="500" step="1" class="zoom-slider svelte-n07j1b"> <span class="zoom-value svelte-n07j1b"> </span></div></div> <!> <!>',1);function fa(pe,ce){De(ce,!1);const[ve,de]=Ne(),me=()=>Pe(k,"$imageEditorStore",ve),w=y(),te=y();let E=y(null),t=y(null),S=y(100),L=1,R=!1,O=NaN,Z=y("Free"),v=y(null),N=y(),M=y(),u=y(),b=y(),oe;const ue=k.subscribe(a=>{e(M)!==a.imageUrl&&a.imageUrl?(o(t,U(e(t))),o(v,null),o(M,a.imageUrl)):!a.imageUrl&&e(t)&&(o(t,U(e(t))),o(v,null),o(M,a.imageUrl)),e(N)!==a.imageUUID&&o(N,a.imageUUID),e(u)!==a.isLoading&&o(u,a.isLoading),e(b)!==a.isApplying&&o(b,a.isApplying),oe!==a.errorMessage&&(oe=a.errorMessage)});async function be(a){if(!a.target)return;const s=a.target,i={width:s.naturalWidth,height:s.naturalHeight};k.imageLoadComplete(i),o(t,U(e(t))),o(v,null);try{await ne(),await le(),fe()}catch(l){k.imageLoadError(`Failed to load cropping library: ${l.message}`)}}function ge(){k.imageLoadError("Error: Failed to load image preview."),o(t,U(e(t)))}async function fe(){if(!(!e(E)||!e(M)||!e(N)||e(t)||typeof Cropper>"u"||e(u)||e(b))&&e(E)&&typeof Cropper<"u"&&!e(t)&&!e(u)&&!e(b))try{o(t,new Cropper(e(E),{aspectRatio:O,viewMode:1,dragMode:"move",autoCropArea:.8,movable:!0,rotatable:!1,scalable:!1,zoomable:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,background:!1,guides:!0,center:!0,highlight:!0,responsive:!0,checkOrientation:!1,modal:!1,crop:he,zoom:je,ready:()=>{const a=e(t).getCanvasData(),s=e(t).getImageData();L=s.naturalWidth>0?a.width/s.naturalWidth:1,o(S,100),_e()}})),isNaN(O)||e(t).setAspectRatio(O)}catch(a){k.imageLoadError(`Failed to initialize cropper: ${a.message}`),o(t,U(e(t)))}}function he(a){e(t)&&!e(b)&&se(e(t).getData(!0))}function _e(){e(t)&&!e(b)?se(e(t).getData(!0)):o(v,null)}function se(a){a&&a.width>0&&a.height>0?o(v,{x:Math.round(a.x),y:Math.round(a.y),width:Math.round(a.width),height:Math.round(a.height)}):(!a||a.width<=0||a.height<=0)&&o(v,null)}function V(a,s){e(u)||e(b)||(O=a,o(Z,s),e(t)&&e(t).setAspectRatio(a))}function ye(a){if(!e(t)||L<=0||e(u)||e(b))return;const s=e(t).getImageData();if(!s||s.naturalWidth===0)return;const i=parseFloat(a.target.value),l=L*(i/100);if(!(l<=0)){R=!0;try{e(t).zoomTo(l)}catch{}finally{le().then(()=>{R=!1})}}}function je(a){if(!e(t)||L<=0||R||e(u)||e(b)){R&&(R=!1);return}const s=e(t).getImageData();if(!s||s.naturalWidth===0)return;const i=a.detail.ratio,l=Math.round(i/L*100),n=Math.max(1,Math.min(500,l));e(S)!==n&&o(S,n)}async function xe(){if(!e(t)||!e(N)||e(b)||e(u))return;const a=e(t).getData(!0);!a||a.width<=0||a.height<=0||await k.applyFilter(s=>Te(s,{x:a.x,y:a.y,width:a.width,height:a.height}),"Crop")}We(async()=>{try{await ne()}catch{}}),He(()=>{ue(),o(t,U(e(t))),k.cleanupBlobUrl()}),re(()=>(e(t),e(u),e(b)),()=>{o(w,!!e(t)&&!e(u)&&!e(b))}),re(()=>(e(w),e(v)),()=>{o(te,e(w)&&!!e(v)&&e(v).width>0&&e(v).height>0)}),we(),Ze(),ke(a=>{$e.title="Crop Image - Slurp Tools"}),Be(pe,{toolTitle:"Image Cropper",toolDescription:"Select an image, adjust the selection, and apply the crop.",$$slots:{"toolbar-left":(a,s)=>{var i=qe(),l=c(d(i),2),g=d(l);let _;var n=c(g,2);let p;var r=c(n,2);let f;var x=c(r,2);let $;m(l),m(i),T((X,J,Y,K)=>{g.disabled=!e(w),_=G(g,1,"svelte-n07j1b",null,_,X),n.disabled=!e(w),p=G(n,1,"svelte-n07j1b",null,p,J),r.disabled=!e(w),f=G(r,1,"svelte-n07j1b",null,f,Y),x.disabled=!e(w),$=G(x,1,"svelte-n07j1b",null,$,K)},[()=>({active:e(Z)==="Free"}),()=>({active:e(Z)==="1:1"}),()=>({active:e(Z)==="4:3"}),()=>({active:e(Z)==="16:9"})],ie),A("click",g,()=>V(NaN,"Free")),A("click",n,()=>V(1,"1:1")),A("click",r,()=>V(4/3,"4:3")),A("click",x,()=>V(16/9,"16:9")),h(a,i)},"toolbar-right":(a,s)=>{var i=Ve(),l=d(i),g=d(l);{var _=p=>{var r=Oe();Ae(),h(p,r)},n=p=>{var r=Ce("Apply Crop");h(p,r)};z(g,p=>{e(b)?p(_):p(n,!1)})}m(l),m(i),T(()=>l.disabled=!e(te)),A("click",l,xe),h(a,i)},"main-content":(a,s)=>{var i=Ge(),l=d(i);{var g=n=>{var p=Xe(),r=d(p);let f;Re(r,x=>o(E,x),()=>e(E)),m(p),T(()=>{ae(r,"src",e(M)),ae(r,"alt",me().originalFilename||"Image to crop"),ae(r,"key",e(M)),f=Se(r,"",f,{opacity:e(u)&&!e(t)?.5:1})}),A("load",r,be),A("error",r,ge),h(n,p)},_=(n,p)=>{{var r=f=>{var x=Ye();h(f,x)};z(n,f=>{e(u)||f(r)},p)}};z(l,n=>{e(M)?n(g):n(_,!1)})}m(i),h(a,i)},"sidebar-content":(a,s)=>{const i=ie(()=>s.openFilePicker);var l=aa(),g=Ie(l);ze(g,{$$events:{openFilePicker(...C){var I;(I=e(i))==null||I.apply(this,C)}}});var _=c(g,2),n=c(d(_),2);{var p=C=>{var I=Je(),P=c(d(I),2),Q=d(P);m(P);var D=c(P,4),W=d(D);m(D);var H=c(D,4),ee=d(H);m(H);var F=c(H,4),B=d(F);m(F),m(I),T(()=>{q(Q,`${e(v).width??""}px`),q(W,`${e(v).height??""}px`),q(ee,`${e(v).x??""}px`),q(B,`${e(v).y??""}px`)}),h(C,I)},r=(C,I)=>{{var P=D=>{var W=Ke();h(D,W)},Q=(D,W)=>{{var H=F=>{var B=Qe();h(F,B)},ee=F=>{var B=ea();h(F,B)};z(D,F=>{e(u)?F(H):F(ee,!1)},W)}};z(C,D=>{e(N)&&!e(u)&&!e(b)?D(P):D(Q,!1)},I)}};z(n,C=>{e(v)&&e(w)?C(p):C(r,!1)})}m(_);var f=c(_,2),x=c(d(f),2),$=c(d(x),2);Me($);var X=c($,2),J=d(X);m(X),m(x),m(f);var Y=c(f,2);Ue(Y,{});var K=c(Y,2);Ee(K,{}),T(()=>{$.disabled=!e(w),q(J,`${e(S)??""}%`)}),Le($,()=>e(S),C=>o(S,C)),A("input",$,ye),h(a,l)}}}),Fe(),de()}export{fa as component};
