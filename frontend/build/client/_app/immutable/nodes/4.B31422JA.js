import{t as k,a as b,b as Fe}from"../chunks/B9q02PmC.js";import"../chunks/CEYA472p.js";import{X as pt,Z as ee,_ as ct,$ as ut,a0 as vt,a1 as Ne,a2 as s,a3 as u,a5 as te,e as Be,d as e,q as m,Y as a,a4 as v,a7 as O,a6 as ge}from"../chunks/CkTvmw98.js";import{h as dt,e as C,s as ae}from"../chunks/l61C7KQG.js";import{i as I}from"../chunks/lPEFebrr.js";import{s as Re,r as he,b as Ie,a as fe,f as Ee}from"../chunks/B1tgAyqo.js";import{s as mt}from"../chunks/D0lxRREg.js";import{F as ht,b as ye,H as ft,D as _t,a as bt}from"../chunks/Dfkrt3rs.js";import{b as gt}from"../chunks/DBx-IR2N.js";import{i as yt}from"../chunks/DNmyc9OO.js";import{o as xt,a as zt}from"../chunks/DnHmEvXm.js";import{I as wt,i as q,E as Mt}from"../chunks/D7iErLRr.js";import{d as ie,l as Se}from"../chunks/ier4OYVO.js";import{a as kt,b as Dt,c as At}from"../chunks/D2J15UbQ.js";var Ct=k('<div slot="toolbar-left" class="tool-switcher svelte-uoep7n"><button>Crop</button> <button>Resize</button> <button>Rotate</button></div>'),Ft=k('<div slot="toolbar-right" class="svelte-uoep7n"></div>'),Nt=k('<div class="img-preview-container svelte-uoep7n"><img class="preview-image svelte-uoep7n" crossorigin="anonymous"></div>'),Rt=k('<div slot="main-content" class="editor-main-content svelte-uoep7n"><!></div>'),It=k('<div class="control-item details svelte-uoep7n"><span class="control-label svelte-uoep7n">Selection (px)</span> <div class="details-grid svelte-uoep7n"><span class="svelte-uoep7n">W:</span> <span class="svelte-uoep7n"> </span> <span class="svelte-uoep7n">H:</span> <span class="svelte-uoep7n"> </span> <span class="svelte-uoep7n">X:</span> <span class="svelte-uoep7n"> </span> <span class="svelte-uoep7n">Y:</span> <span class="svelte-uoep7n"> </span></div></div>'),Et=k('<div class="control-item details svelte-uoep7n"><span class="control-label svelte-uoep7n">Selection (px)</span> <p class="placeholder-text-small svelte-uoep7n">Initializing...</p></div>'),St=k('<span class="button-spinner svelte-uoep7n"></span> Applying...',1),Tt=k('<div class="sidebar-section section-crop svelte-uoep7n"><h4 class="h4-blue svelte-uoep7n">Crop Options</h4> <div class="control-item zoom-controls svelte-uoep7n"><label for="crop-zoom-slider" class="svelte-uoep7n">Zoom</label> <input id="crop-zoom-slider" type="range" min="1" max="500" step="1" class="zoom-slider svelte-uoep7n"> <span class="zoom-value svelte-uoep7n"> </span></div> <!> <button class="button-like apply-button apply-crop svelte-uoep7n"><!></button></div>'),Lt=k('<p class="original-dims-info svelte-uoep7n"> </p> <div class="dimension-inputs svelte-uoep7n"><div class="input-group svelte-uoep7n"><label for="resize-width" class="svelte-uoep7n">Width (px)</label> <input type="number" id="resize-width" min="1" placeholder="Width" class="svelte-uoep7n"></div> <div class="input-group svelte-uoep7n"><label for="resize-height" class="svelte-uoep7n">Height (px)</label> <input type="number" id="resize-height" min="1" placeholder="Height" class="svelte-uoep7n"></div></div> <div class="aspect-toggle svelte-uoep7n"><label title="Maintain aspect ratio" class="svelte-uoep7n"><input type="checkbox" class="svelte-uoep7n"> <span class="svelte-uoep7n">Lock aspect ratio</span></label></div>',1),Ut=k('<p class="placeholder-text svelte-uoep7n">Loading dimensions...</p>'),Wt=k('<p class="placeholder-text svelte-uoep7n">Load image first.</p>'),Zt=k('<span class="button-spinner svelte-uoep7n"></span> Applying...',1),$t=k('<div class="sidebar-section section-resize svelte-uoep7n"><h4 class="h4-pink svelte-uoep7n">Resize Options</h4> <!> <button class="button-like apply-button apply-resize svelte-uoep7n"><!></button></div>'),Ht=k('<span class="button-spinner svelte-uoep7n"></span> Applying...',1),Pt=k('<div class="sidebar-section section-rotate svelte-uoep7n"><h4 class="h4-maroon svelte-uoep7n">Rotate Options</h4> <div class="control-item rotation-slider-group svelte-uoep7n"><label for="rotation-slider" class="svelte-uoep7n">Angle</label> <div class="slider-container svelte-uoep7n"><input id="rotation-slider" type="range" min="-180" max="180" step="1" class="rotation-slider svelte-uoep7n"> <span class="rotation-value svelte-uoep7n"> </span></div></div> <div class="control-item quick-rotate-buttons svelte-uoep7n"><button class="button-like quick-button svelte-uoep7n">-90°</button> <button class="button-like quick-button svelte-uoep7n">0°</button> <button class="button-like quick-button svelte-uoep7n">+90°</button> <button class="button-like quick-button svelte-uoep7n">180°</button></div> <button class="button-like apply-button apply-rotate svelte-uoep7n"><!></button></div>'),Ot=k("<!> <!>",1),qt=k('<div class="sidebar-error-container svelte-uoep7n"><!></div>'),Bt=k("<!> <!> <!> <!> <!> <!>",1);function sa(Ve,Xe){pt(Xe,!1);const ue=m(),Te=m(),xe=m(),Le=m(),Ue=m(),T=m(),ze=m();let w=m("crop"),g=m(null),oe=m(""),d=m(!1),p=m(!1),We=m(""),l=m(null),we=m(""),Ze=m(null),Me=()=>{},ve=m(null),r=m(null),re=m(100),se=1,de=!1,ke=NaN,E=m(null);async function $e(){if(e(w)!=="crop"||!e(ve)||!e(oe)||!e(g)||e(r)||typeof Cropper>"u"||e(d)||e(p))return;const t=e(r);if(a(r,null),ie(t),await O(),e(ve)&&typeof Cropper<"u"&&!e(r)&&!e(d)&&!e(p)&&e(w)==="crop")try{a(r,new Cropper(e(ve),{aspectRatio:ke,viewMode:1,dragMode:"move",autoCropArea:.8,movable:!0,rotatable:!1,scalable:!1,zoomable:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,background:!1,guides:!0,center:!0,highlight:!0,responsive:!0,checkOrientation:!1,modal:!1,crop:Ye,zoom:Ge,ready:()=>{var n,F;const i=(n=e(r))==null?void 0:n.getCanvasData(),o=(F=e(r))==null?void 0:F.getImageData();i&&o?se=o.naturalWidth>0?i.width/o.naturalWidth:1:se=1,a(re,100),Ke()}})),isNaN(ke)||e(r).setAspectRatio(ke)}catch(i){q.imageLoadError(`Failed to initialize cropper: ${i.message}`),a(r,ie(e(r)))}}function Ye(t){e(r)&&!e(p)&&He(e(r).getData(!0))}function Ke(){e(r)&&!e(p)?He(e(r).getData(!0)):a(E,null)}function He(t){t&&t.width>0&&t.height>0?a(E,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}):(!t||t.width<=0||t.height<=0)&&a(E,null)}function je(t){if(!e(r)||se<=0||e(d)||e(p))return;const i=e(r).getImageData();if(!i||i.naturalWidth===0)return;const o=parseFloat(t.target.value),n=se*(o/100);if(!(n<=0)){de=!0;try{e(r).zoomTo(n)}catch{}finally{O().then(()=>{de=!1})}}}function Ge(t){if(!e(r)||se<=0||de||e(d)||e(p)){de&&(de=!1);return}const i=e(r).getImageData();if(!i||i.naturalWidth===0)return;const o=t.detail.ratio,n=Math.round(o/se*100),N=Math.max(1,Math.min(500,n));e(re)!==N&&a(re,N)}async function Je(){if(!e(r)||!e(g)||e(p)||e(d))return;const t=e(r).getData(!0);if(!t||t.width<=0||t.height<=0)return;const i=e(r);a(r,null),ie(i),a(E,null),await q.applyFilter(o=>kt(o,{x:t.x,y:t.y,width:t.width,height:t.height}),"Crop")}const y=5e3;let D=m(""),A=m(""),ne=m(!0),$=!1,K=m("");function De(t,i){if(!t||!i)return;$=!0;let o=Math.max(1,Math.min(t,y)),n=Math.max(1,Math.min(i,y));const F=t/i;e(ne)&&(t>y||i>y)&&(o>n?(o=y,n=Math.max(1,Math.round(o/F)),n=Math.min(n,y)):(n=y,o=Math.max(1,Math.round(n*F)),o=Math.min(o,y))),a(D,o),a(A,n),O().then(()=>$=!1)}function Pe(){if($||!e(ne)||!e(l)||typeof e(D)!="number"||e(D)<=0)return;$=!0,a(K,"");let t=Math.max(1,Math.min(e(D),y));t!==e(D)&&a(D,t);const i=e(l).width/e(l).height;if(isNaN(i)||i<=0||e(l).height===0){O().then(()=>$=!1);return}const o=Math.round(t/i),n=Math.max(1,Math.min(o,y));e(A)!==n&&a(A,n),O().then(()=>$=!1)}function Qe(){if($||!e(ne)||!e(l)||typeof e(A)!="number"||e(A)<=0)return;$=!0,a(K,"");let t=Math.max(1,Math.min(e(A),y));t!==e(A)&&a(A,t);const i=e(l).width/e(l).height;if(isNaN(i)||i<=0){O().then(()=>$=!1);return}const o=Math.round(t*i),n=Math.max(1,Math.min(o,y));e(D)!==n&&a(D,n),O().then(()=>$=!1)}function et(){e(ne)&&e(l)&&Pe()}async function tt(){a(K,"");const t=Number(e(D)),i=Number(e(A));if(!(!e(g)||e(d)||e(p))){if(isNaN(t)||isNaN(i)||t<=0||i<=0){a(K,"Invalid dimensions.");return}if(t>y||i>y){a(K,`Max dimension is ${y}px.`);return}if(!e(l)){a(K,"Original dimensions not loaded.");return}await q.applyFilter(o=>Dt(o,t,i),"Resize")}}let me=m(0);function _e(t){e(d)||e(p)||a(me,t)}async function at(){if(!e(g)||e(d)||e(p))return;const t=Number(e(me));isNaN(t)||await q.applyFilter(i=>At(i,t),`Rotate ${t}°`)}async function Ae(t){if(!(e(d)||e(p)||t===e(w))){if(e(w)==="crop"&&t!=="crop"){const i=e(r);a(r,null),ie(i)}if(a(w,t),t==="crop"&&e(g)&&!e(d)&&!e(p))try{await Se(),await O(),$e()}catch{q.imageLoadError("Failed to load cropping library.")}else t==="resize"&&e(l)&&!e(d)&&!e(p)&&De(e(l).width,e(l).height)}}async function it(t){if(!t.target)return;const i=t.target,o={width:i.naturalWidth,height:i.naturalHeight};if(q.imageLoadComplete(o),await O(),e(w)==="crop"&&!e(d)&&!e(p))try{await Se(),await O(),$e()}catch{q.imageLoadError("Failed to load cropping library.")}else e(w)==="resize"&&e(l)&&!e(d)&&!e(p)&&De(e(l).width,e(l).height)}function ot(){q.imageLoadError("Error: Failed to load image preview.");const t=e(r);a(r,null),ie(t)}xt(()=>{Me=q.subscribe(t=>{if(a(g,t.imageUUID),e(oe)!==t.imageUrl&&(a(oe,t.imageUrl),a(Ze,t.currentBlobUrl),e(r))){const i=e(r);a(r,null),ie(i),a(E,null)}a(d,t.isLoading),a(p,t.isApplying),a(We,t.originalFilename),t.imageInfo,e(l)!==t.originalDimensions&&(a(l,t.originalDimensions),e(w)==="resize"&&e(l)&&!e(d)&&!e(p)?De(e(l).width,e(l).height):e(l)||(a(D,""),a(A,""))),a(we,t.errorMessage)}),Se().catch(t=>{})}),zt(()=>{Me&&Me();const t=e(r);a(r,null),ie(t),q.cleanupBlobUrl()}),ee(()=>(e(r),e(d),e(p)),()=>{a(ue,!!e(r)&&!e(d)&&!e(p))}),ee(()=>(e(ue),e(E)),()=>{a(Te,e(ue)&&!!e(E)&&e(E).width>0&&e(E).height>0)}),ee(()=>(e(D),e(A)),()=>{a(xe,typeof e(D)=="number"&&e(D)>0&&e(D)<=y&&typeof e(A)=="number"&&e(A)>0&&e(A)<=y)}),ee(()=>(e(g),e(l),e(d),e(p),e(xe)),()=>{a(Le,!!e(g)&&!!e(l)&&!e(d)&&!e(p)&&e(xe))}),ee(()=>(e(g),e(d),e(p)),()=>{a(Ue,!!e(g)&&!e(d)&&!e(p))}),ee(()=>(e(d),e(p)),()=>{a(T,e(d)||e(p))}),ee(()=>(e(K),e(we)),()=>{a(ze,e(K)||e(we))}),ct(),yt(),dt(t=>{vt.title="Image Editor - Slurp Tools"}),wt(Ve,{toolTitle:"All-in-One Image Editor",toolDescription:"Crop, resize, or rotate your image.",$$slots:{"toolbar-left":(t,i)=>{var o=Ct(),n=u(o);let F;var B=s(n,2);let N;var Z=s(B,2);let R;v(o),te((V,le,Ce)=>{n.disabled=e(T),F=Re(n,1,"svelte-uoep7n",null,F,V),B.disabled=e(T),N=Re(B,1,"svelte-uoep7n",null,N,le),Z.disabled=e(T),R=Re(Z,1,"svelte-uoep7n",null,R,Ce)},[()=>({active:e(w)==="crop"}),()=>({active:e(w)==="resize"}),()=>({active:e(w)==="rotate"})],Be),C("click",n,()=>Ae("crop")),C("click",B,()=>Ae("resize")),C("click",Z,()=>Ae("rotate")),b(t,o)},"toolbar-right":(t,i)=>{var o=Ft();b(t,o)},"main-content":(t,i)=>{var o=Rt(),n=u(o);{var F=N=>{var Z=Nt(),R=u(Z);let V;gt(R,le=>a(ve,le),()=>e(ve)),v(Z),te(()=>{fe(R,"src",e(oe)),fe(R,"alt",e(We)||"Image to edit"),fe(R,"key",e(oe)),V=mt(R,"",V,{opacity:e(T)?.7:1,visibility:e(w)==="crop"&&!e(r)&&!e(d)?"hidden":"visible"})}),C("load",R,it),C("error",R,ot),b(N,Z)},B=(N,Z)=>{{var R=V=>{};I(N,V=>{e(d)||V(R)},Z)}};I(n,N=>{e(oe)?N(F):N(B,!1)})}v(o),b(t,o)},"sidebar-content":(t,i)=>{const o=Be(()=>i.openFilePicker);var n=Bt(),F=Ne(n);{var B=h=>{ht(h,{$$events:{openFilePicker(...f){var M;(M=e(o))==null||M.apply(this,f)}}})};I(F,h=>{(e(g)||e(Ze))&&h(B)})}var N=s(F,2);{var Z=h=>{var f=Tt(),M=s(u(f),2),U=s(u(M),2);he(U);var X=s(U,2),Y=u(X);v(X),v(M);var pe=s(M,2);{var G=c=>{var x=It(),W=s(u(x),2),z=s(u(W),2),L=u(z,!0);v(z);var ce=s(z,4),be=u(ce,!0);v(ce);var j=s(ce,4),Q=u(j,!0);v(j);var qe=s(j,4),lt=u(qe,!0);v(qe),v(W),v(x),te(()=>{ae(L,e(E).width),ae(be,e(E).height),ae(Q,e(E).x),ae(lt,e(E).y)}),b(c,x)},J=(c,x)=>{{var W=z=>{var L=Et();b(z,L)};I(c,z=>{e(g)&&!e(d)&&z(W)},x)}};I(pe,c=>{e(E)&&e(ue)?c(G):c(J,!1)})}var _=s(pe,2),S=u(_);{var H=c=>{var x=St();ge(),b(c,x)},P=c=>{var x=Fe(`Apply
						Crop`);b(c,x)};I(S,c=>{e(p)&&e(w)==="crop"?c(H):c(P,!1)})}v(_),v(f),te(()=>{U.disabled=!e(ue),ae(Y,`${e(re)??""}%`),_.disabled=!e(Te)}),ye(U,()=>e(re),c=>a(re,c)),C("input",U,je),C("click",_,Je),Ie(3,f,()=>Ee,()=>({duration:150})),b(h,f)};I(N,h=>{e(w)==="crop"&&h(Z)})}var R=s(N,2);{var V=h=>{var f=$t(),M=s(u(f),2);{var U=_=>{var S=Lt(),H=Ne(S),P=u(H);v(H);var c=s(H,2),x=u(c),W=s(u(x),2);he(W),fe(W,"max",y),v(x);var z=s(x,2),L=s(u(z),2);he(L),fe(L,"max",y),v(z),v(c);var ce=s(c,2),be=u(ce),j=u(be);he(j),ge(2),v(be),v(ce),te(()=>{ae(P,`Current: ${e(l).width??""} x ${e(l).height??""} px`),W.disabled=e(T)||!e(l),L.disabled=e(T)||!e(l),j.disabled=e(T)||!e(l)}),ye(W,()=>e(D),Q=>a(D,Q)),C("input",W,Pe),ye(L,()=>e(A),Q=>a(A,Q)),C("input",L,Qe),bt(j,()=>e(ne),Q=>a(ne,Q)),C("change",j,et),b(_,S)},X=(_,S)=>{{var H=c=>{var x=Ut();b(c,x)},P=c=>{var x=Wt();b(c,x)};I(_,c=>{e(g)&&e(d)?c(H):c(P,!1)},S)}};I(M,_=>{e(l)?_(U):_(X,!1)})}var Y=s(M,2),pe=u(Y);{var G=_=>{var S=Zt();ge(),b(_,S)},J=_=>{var S=Fe(`Apply
						Resize`);b(_,S)};I(pe,_=>{e(p)&&e(w)==="resize"?_(G):_(J,!1)})}v(Y),v(f),te(()=>Y.disabled=!e(Le)),C("click",Y,tt),Ie(3,f,()=>Ee,()=>({duration:150})),b(h,f)};I(R,h=>{e(w)==="resize"&&h(V)})}var le=s(R,2);{var Ce=h=>{var f=Pt(),M=s(u(f),2),U=s(u(M),2),X=u(U);he(X);var Y=s(X,2),pe=u(Y);v(Y),v(U),v(M);var G=s(M,2),J=u(G),_=s(J,2),S=s(_,2),H=s(S,2);v(G);var P=s(G,2),c=u(P);{var x=z=>{var L=Ht();ge(),b(z,L)},W=z=>{var L=Fe(`Apply
						Rotation`);b(z,L)};I(c,z=>{e(p)&&e(w)==="rotate"?z(x):z(W,!1)})}v(P),v(f),te(()=>{X.disabled=e(T)||!e(g),ae(pe,`${e(me)??""}°`),J.disabled=e(T)||!e(g),_.disabled=e(T)||!e(g),S.disabled=e(T)||!e(g),H.disabled=e(T)||!e(g),P.disabled=!e(Ue)}),ye(X,()=>e(me),z=>a(me,z)),C("click",J,()=>_e(-90)),C("click",_,()=>_e(0)),C("click",S,()=>_e(90)),C("click",H,()=>_e(180)),C("click",P,at),Ie(3,f,()=>Ee,()=>({duration:150})),b(h,f)};I(le,h=>{e(w)==="rotate"&&h(Ce)})}var Oe=s(le,2);{var rt=h=>{var f=Ot(),M=Ne(f);ft(M,{});var U=s(M,2);_t(U,{}),b(h,f)};I(Oe,h=>{e(g)&&h(rt)})}var st=s(Oe,2);{var nt=h=>{var f=qt(),M=u(f);Mt(M,{get message(){return e(ze)},context:"sidebar"}),v(f),b(h,f)};I(st,h=>{e(ze)&&h(nt)})}b(t,n)}}}),ut()}export{sa as component};
